import{j as e,u as U,r as i,A as N,L as C,a as z}from"./index-D1Lswkrq.js";import{C as E,u as V,I as p,V as _,a as R,b as g}from"./form-hook-Bbwc43bC.js";import{u as y,E as w,B as G,C as J,R as Q,M as X}from"./http-hook-B9TVr8Bm.js";const K=t=>e.jsx(e.Fragment,{children:e.jsx("li",{className:"item",children:e.jsx(E,{className:"item__content",children:e.jsxs("div",{className:"item__text",style:{"--user-title-color":t.userTitleColor},children:[e.jsx("h2",{style:{"--user-title-color":t.userTitleColor},children:t.title}),e.jsx("p",{children:t.description}),e.jsxs("div",{className:"button-stack",children:[e.jsx("button",{onClick:t.showEditModalHandler,children:"edit"}),e.jsx("button",{onClick:t.showDeleteModalHandler,children:"delete"})]})]})})})}),W=t=>(U(),t.items.length===0?e.jsx("div",{className:"items-list",children:e.jsx("div",{className:"item",children:e.jsx(E,{className:"item__content",children:"To Do List is empty."})})}):e.jsx("ul",{className:"items-list",children:t.items.map(s=>e.jsx(K,{id:s.id,title:s.title,description:s.description,showEditModalHandler:()=>t.showEditModalHandler(s.id),showDeleteModalHandler:()=>t.showDeleteModalHandler(s.id),userTitleColor:t.userTitleColor},s.id))})),Y=t=>{const s=i.useContext(N),{isLoading:c,error:h,sendRequest:r,clearError:x}=y(),[o,a]=V({title:{value:"",isValid:!1},description:{value:"",isValid:!1}},!1),u=async m=>{m.preventDefault();try{const l=await r("https://todoapp-backend-vqt1.onrender.com/api/items","POST",JSON.stringify({title:o.inputs.title.value,description:o.inputs.description.value}),{"Content-Type":"application/json",Authorization:"Bearer "+s.token});t.onItemAdded(l.item),t.closeAddHandler()}catch{}};return e.jsxs(e.Fragment,{children:[e.jsx(w,{error:h,onClear:x}),e.jsx("div",{className:"items-list",children:e.jsx("div",{className:"add-item",children:e.jsx(E,{className:"add-item__content",children:e.jsxs("form",{className:"add-item__form",onSubmit:u,children:[e.jsxs("div",{className:"add-item__input",children:[c&&e.jsx(C,{asOverlay:!0}),e.jsx(p,{id:"title",element:"input",name:"toDoItem",placeholder:"to do item",className:"add-input",validators:[_()],errorText:"Please enter a valid title.",onInput:a}),e.jsx(p,{id:"description",element:"textarea",name:"description",placeholder:"description",className:"add-textarea",validators:[R(3),g(150)],errorText:"Please enter a valid description (at least 5 characters, max 150).",onInput:a})]}),e.jsxs("div",{className:"add-button-stack",children:[e.jsx("button",{type:"submit",disabled:!o.isValid,className:`btn ${o.isValid?"":"btn-disabled"}`,children:"add"}),e.jsx("button",{type:"button",onClick:t.closeAddHandler,children:"cancel"})]})]})})})})]})},Z=t=>{const s=i.useContext(N),{error:c,sendRequest:h,clearError:r}=y(),[x,o]=i.useState(!1),[a,u,m]=V({title:{value:"",isValid:!1},description:{value:"",isValid:!1}},!1),l=t.Items?t.Items.find(f=>f.id===t.itemId):null;i.useEffect(()=>{l&&m({title:{value:l.title,isValid:!0},description:{value:l.description,isValid:!0}},!0),o(!0)},[m,l]);const j=async f=>{f.preventDefault();try{await h(`https://todoapp-backend-vqt1.onrender.com/api/items/${t.itemId}`,"PATCH",JSON.stringify({title:a.inputs.title.value,description:a.inputs.description.value}),{"Content-Type":"application/json",Authorization:"Bearer "+s.token}),t.onItemUpdated&&t.onItemUpdated({id:t.itemId,title:a.inputs.title.value,description:a.inputs.description.value}),t.closeEditModalHandler()}catch{}};if(!l&&t.show&&!c)return e.jsx("div",{className:"center",children:"Couldnot find place"});const I=x?e.jsxs(e.Fragment,{children:[e.jsx(w,{error:c,onClear:r}),e.jsxs("form",{className:"container-child",onSubmit:j,children:[e.jsx("h3",{className:"header",children:"edit item"}),e.jsxs("div",{className:"edit__input",children:[e.jsx(p,{id:"title",element:"input",name:"toDoItem",placeholder:"to do item",className:"edit-input",validators:[_()],errorText:"Please enter a valid title.",onInput:u,initialValue:a.inputs.title.value,initialValidity:a.inputs.title.isValid}),e.jsx(p,{id:"description",element:"textarea",name:"description",placeholder:"description",className:"edit-textarea",validators:[R(3),g(150)],errorText:"Please enter a valid description (at least 5 characters, max 150).",onInput:u,initialValue:a.inputs.description.value,initialValidity:a.inputs.description.isValid})]}),e.jsxs("div",{className:"button-stack__edit",children:[e.jsx("button",{type:"submit",disabled:!a.isValid,className:`btn ${a.isValid?"":"btn-disabled"}`,children:"ok"}),e.jsx("button",{type:"button",onClick:t.closeEditModalHandler,children:"cancel"})]})]})]}):e.jsx("div",{className:"center",children:e.jsx(C,{})});return Q.createPortal(e.jsx("div",{ref:t.nodeRef,className:"container",children:I}),document.getElementById("edit-hook"))},ee=t=>{const s=i.useRef(null);return e.jsxs(e.Fragment,{children:[t.show&&e.jsx(G,{onClickProp:t.onCancel}),e.jsx(J,{in:t.show,mountOnEnter:!0,unmountOnExit:!0,timeout:300,classNames:"fade",nodeRef:s,children:e.jsx(Z,{...t,nodeRef:s})})]})},ie=()=>{const t=i.useContext(N),s=z().uid,{isLoading:c,error:h,sendRequest:r,clearError:x}=y(),[o,a]=i.useState();i.useEffect(()=>{(async()=>{try{const d=await r(`https://todoapp-backend-vqt1.onrender.com/api/items/user/${s}`,"GET",null,{Authorization:"Bearer "+t.token});a(d.itemsList)}catch{}})()},[r,s]);const[u,m]=i.useState("#ffd900");i.useEffect(()=>{(async()=>{try{const d=await r(`https://todoapp-backend-vqt1.onrender.com/api/users/${s}/userInfo`,"GET",null,{Authorization:"Bearer "+t.token});m(d.userTitleColor||"#ffd900")}catch{}})()},[r,s]);const[l,j]=i.useState(!1),I=()=>{j(!0)},f=()=>{j(!1)},A=n=>{a(d=>[...d,n])},[L,D]=i.useState(!1),[O,H]=i.useState(null),P=n=>{H(n),D(!0)},T=()=>{D(!1),H(null)},$=n=>{a(d=>d.map(M=>M.id===n.id?n:M))},[F,v]=i.useState(!1),[b,k]=i.useState(null),q=n=>{k(n),v(!0)},S=()=>{v(!1),k(null)},B=async()=>{v(!1);try{await r(`https://todoapp-backend-vqt1.onrender.com/api/items/${b}`,"DELETE",null,{Authorization:"Bearer "+t.token}),a(n=>n.filter(d=>d.id!==b))}catch{}};return e.jsxs(e.Fragment,{children:[e.jsx(w,{error:h,onClear:x}),c&&e.jsx("div",{className:"center",children:e.jsx(C,{})}),e.jsx(ee,{userId:s,itemId:O,show:L,onCancel:T,closeEditModalHandler:T,Items:o,onItemUpdated:$}),e.jsx(X,{userId:s,itemId:b,show:F,onCancel:S,footerClass:"footer",footer:e.jsxs(e.Fragment,{children:[e.jsx("button",{type:"button",onClick:B,children:"delete"}),e.jsx("button",{type:"button",onClick:S,children:"cancel"})]}),children:e.jsx("p",{children:"Please confirm deletion."})}),!c&&o&&e.jsx(W,{items:o,showEditModalHandler:P,showDeleteModalHandler:q,userTitleColor:u}),l&&e.jsx(Y,{closeAddHandler:f,onItemAdded:A}),!l&&e.jsx("div",{className:"items-list",children:e.jsx("button",{className:"toDo-add-button",onClick:I,children:"+"})})]})};export{ie as default};
