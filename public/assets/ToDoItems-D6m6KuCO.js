import{j as e,u as $,r as i,A as E,L as C,a as q}from"./index-DbfpWJMY.js";import{C as y,u as w,a as V,E as H,I as p,V as _,b as T,B,c as U,R as z,M as G}from"./http-hook-BlkUq6PP.js";const J=t=>e.jsx(e.Fragment,{children:e.jsx("li",{className:"item",children:e.jsx(y,{className:"item__content",children:e.jsxs("div",{className:"item__text",children:[e.jsx("h2",{children:t.title}),e.jsx("p",{children:t.description}),e.jsxs("div",{className:"button-stack",children:[e.jsx("button",{onClick:t.showEditModalHandler,children:"edit"}),e.jsx("button",{onClick:t.showDeleteModalHandler,children:"delete"})]})]})})})}),Q=t=>($(),t.items.length===0?e.jsx("div",{className:"items-list",children:e.jsx("div",{className:"item",children:e.jsx(y,{className:"item__content",children:"To Do List is empty."})})}):e.jsx("ul",{className:"items-list",children:t.items.map(s=>e.jsx(J,{id:s.id,title:s.title,description:s.description,showEditModalHandler:()=>t.showEditModalHandler(s.id),showDeleteModalHandler:()=>t.showDeleteModalHandler(s.id)},s.id))})),K=t=>{const s=i.useContext(E),{isLoading:r,error:h,sendRequest:c,clearError:x}=w(),[l,a]=V({title:{value:"",isValid:!1},description:{value:"",isValid:!1}},!1),m=async u=>{u.preventDefault();try{const d=await c("https://todoapp-backend-vqt1.onrender.com/api/items","POST",JSON.stringify({title:l.inputs.title.value,description:l.inputs.description.value}),{"Content-Type":"application/json",Authorization:"Bearer "+s.token});t.onItemAdded(d.item),t.closeAddHandler()}catch{}};return e.jsxs(e.Fragment,{children:[e.jsx(H,{error:h,onClear:x}),e.jsx("div",{className:"items-list",children:e.jsx("div",{className:"add-item",children:e.jsx(y,{className:"add-item__content",children:e.jsxs("form",{className:"add-item__form",onSubmit:m,children:[e.jsxs("div",{className:"add-item__input",children:[r&&e.jsx(C,{asOverlay:!0}),e.jsx(p,{id:"title",element:"input",name:"toDoItem",placeholder:"to do item",className:"add-input",validators:[_()],errorText:"Please enter a valid title.",onInput:a}),e.jsx(p,{id:"description",element:"textarea",name:"description",placeholder:"description",className:"add-textarea",validators:[T(3)],errorText:"Please enter a valid description (at least 5 characters).",onInput:a})]}),e.jsxs("div",{className:"add-button-stack",children:[e.jsx("button",{type:"submit",disabled:!l.isValid,className:`btn ${l.isValid?"":"btn-disabled"}`,children:"add"}),e.jsx("button",{type:"button",onClick:t.closeAddHandler,children:"cancel"})]})]})})})})]})},W=t=>{const s=i.useContext(E),{error:r,sendRequest:h,clearError:c}=w(),[x,l]=i.useState(!1),[a,m,u]=V({title:{value:"",isValid:!1},description:{value:"",isValid:!1}},!1),d=t.Items?t.Items.find(j=>j.id===t.itemId):null;i.useEffect(()=>{d&&u({title:{value:d.title,isValid:!0},description:{value:d.description,isValid:!0}},!0),l(!0)},[u,d]);const f=async j=>{j.preventDefault();try{await h(`https://todoapp-backend-vqt1.onrender.com/api/items/${t.itemId}`,"PATCH",JSON.stringify({title:a.inputs.title.value,description:a.inputs.description.value}),{"Content-Type":"application/json",Authorization:"Bearer "+s.token}),t.onItemUpdated&&t.onItemUpdated({id:t.itemId,title:a.inputs.title.value,description:a.inputs.description.value}),t.closeEditModalHandler()}catch{}};if(!d&&t.show&&!r)return e.jsx("div",{className:"center",children:"Couldnot find place"});const I=x?e.jsxs(e.Fragment,{children:[e.jsx(H,{error:r,onClear:c}),e.jsxs("form",{className:"container-child",onSubmit:f,children:[e.jsx("h3",{className:"header",children:"edit item"}),e.jsxs("div",{className:"edit__input",children:[e.jsx(p,{id:"title",element:"input",name:"toDoItem",placeholder:"to do item",className:"edit-input",validators:[_()],errorText:"Please enter a valid title.",onInput:m,initialValue:a.inputs.title.value,initialValidity:a.inputs.title.isValid}),e.jsx(p,{id:"description",element:"textarea",name:"description",placeholder:"description",className:"edit-textarea",validators:[T(3)],errorText:"Please enter a valid description (at least 5 characters).",onInput:m,initialValue:a.inputs.description.value,initialValidity:a.inputs.description.isValid})]}),e.jsxs("div",{className:"button-stack__edit",children:[e.jsx("button",{type:"submit",disabled:!a.isValid,className:`btn ${a.isValid?"":"btn-disabled"}`,children:"ok"}),e.jsx("button",{type:"button",onClick:t.closeEditModalHandler,children:"cancel"})]})]})]}):e.jsx("div",{className:"center",children:e.jsx(C,{})});return z.createPortal(e.jsx("div",{ref:t.nodeRef,className:"container",children:I}),document.getElementById("edit-hook"))},X=t=>{const s=i.useRef(null);return e.jsxs(e.Fragment,{children:[t.show&&e.jsx(B,{onClickProp:t.onCancel}),e.jsx(U,{in:t.show,mountOnEnter:!0,unmountOnExit:!0,timeout:300,classNames:"fade",nodeRef:s,children:e.jsx(W,{...t,nodeRef:s})})]})},ee=()=>{const t=i.useContext(E),s=q().uid,{isLoading:r,error:h,sendRequest:c,clearError:x}=w(),[l,a]=i.useState();i.useEffect(()=>{(async()=>{try{const o=await c(`https://todoapp-backend-vqt1.onrender.com/api/items/user/${s}`,"GET",null,{Authorization:"Bearer "+t.token});a(o.itemsList)}catch{}})()},[c,s]);const[m,u]=i.useState(!1),d=()=>{u(!0)},f=()=>{u(!1)},I=n=>{a(o=>[...o,n])},[j,v]=i.useState(!1),[R,S]=i.useState(null),g=n=>{S(n),v(!0)},k=()=>{v(!1),S(null)},L=n=>{a(o=>o.map(M=>M.id===n.id?n:M))},[O,N]=i.useState(!1),[b,D]=i.useState(null),P=n=>{D(n),N(!0)},A=()=>{N(!1),D(null)},F=async()=>{N(!1);try{await c(`https://todoapp-backend-vqt1.onrender.com/api/items/${b}`,"DELETE",null,{Authorization:"Bearer "+t.token}),a(n=>n.filter(o=>o.id!==b))}catch{}};return e.jsxs(e.Fragment,{children:[e.jsx(H,{error:h,onClear:x}),r&&e.jsx("div",{className:"center",children:e.jsx(C,{})}),e.jsx(X,{userId:s,itemId:R,show:j,onCancel:k,closeEditModalHandler:k,Items:l,onItemUpdated:L}),e.jsx(G,{userId:s,itemId:b,show:O,onCancel:A,footerClass:"footer",footer:e.jsxs(e.Fragment,{children:[e.jsx("button",{type:"button",onClick:F,children:"delete"}),e.jsx("button",{type:"button",onClick:A,children:"cancel"})]}),children:e.jsx("p",{children:"Please confirm deletion."})}),!r&&l&&e.jsx(Q,{items:l,showEditModalHandler:g,showDeleteModalHandler:P}),m&&e.jsx(K,{closeAddHandler:f,onItemAdded:I}),!m&&e.jsx("div",{className:"items-list",children:e.jsx("button",{className:"item",onClick:d,children:"+"})})]})};export{ee as default};
